{% extends 'dashboard/base.html' %}

{% block title %}Designs - Raggey Admin{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="mb-6">
    <h1 class="text-3xl font-bold text-[#0D1210] mb-2">Design Components</h1>
    <p class="text-sm text-[#6A736E]">Manage fabric types, colors, collars, sleeves, and more</p>
</div>

<!-- Statistics Cards -->
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
    <div class="bg-white border border-[#E6E8E7] rounded-2xl p-6">
        <p class="text-sm text-[#6A736E] font-medium mb-2">Total {{ component_label }}</p>
        <p class="text-3xl font-bold text-[#0D1210]">{{ total_items }}</p>
    </div>
    <div class="bg-white border border-[#E6E8E7] rounded-2xl p-6">
        <p class="text-sm text-[#6A736E] font-medium mb-2">Showing</p>
        <p class="text-3xl font-bold text-[#5D0B33]">{{ current_count }}</p>
    </div>
</div>

<!-- Component Type Tabs -->
<div class="bg-white border border-[#E6E8E7] rounded-2xl p-6 mb-6">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold text-[#0D1210]">Component Type</h2>
        <div class="flex items-center gap-3">
            {% if order_item_id %}
            <a href="/dashboard/designs/?type={{ component_type }}"
                class="px-4 py-2 bg-[#BF3636] text-white rounded-lg font-medium hover:bg-[#A02D2D] transition-colors flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
                Reset Filter
            </a>
            {% endif %}
            <button onclick="openAddModal()"
                class="px-4 py-2 bg-[#5D0B33] text-white rounded-lg font-medium hover:bg-[#4a0829] transition-colors flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                Add New
            </button>
        </div>
    </div>

    <div class="flex flex-wrap gap-2 mb-6">
        <a href="?type=fabric_colors{% if search_query %}&search={{ search_query }}{% endif %}{% if order_item_id %}&order_item={{ order_item_id }}{% endif %}"
            class="px-4 py-2 rounded-lg font-medium transition-colors {% if component_type == 'fabric_colors' %}bg-[#5D0B33] text-white{% else %}bg-[#F5F6F6] text-[#6A736E] hover:bg-[#E6E8E7]{% endif %}">
            Fabric Colors ({{ component_counts.fabric_colors }})
        </a>
        <a href="?type=fabric_types{% if search_query %}&search={{ search_query }}{% endif %}{% if order_item_id %}&order_item={{ order_item_id }}{% endif %}"
            class="px-4 py-2 rounded-lg font-medium transition-colors {% if component_type == 'fabric_types' %}bg-[#5D0B33] text-white{% else %}bg-[#F5F6F6] text-[#6A736E] hover:bg-[#E6E8E7]{% endif %}">
            Fabric Types ({{ component_counts.fabric_types }})
        </a>
        <a href="?type=collars{% if search_query %}&search={{ search_query }}{% endif %}{% if order_item_id %}&order_item={{ order_item_id }}{% endif %}"
            class="px-4 py-2 rounded-lg font-medium transition-colors {% if component_type == 'collars' %}bg-[#5D0B33] text-white{% else %}bg-[#F5F6F6] text-[#6A736E] hover:bg-[#E6E8E7]{% endif %}">
            Collars ({{ component_counts.collars }})
        </a>
        <a href="?type=sleeves{% if search_query %}&search={{ search_query }}{% endif %}{% if order_item_id %}&order_item={{ order_item_id }}{% endif %}"
            class="px-4 py-2 rounded-lg font-medium transition-colors {% if component_type == 'sleeves' %}bg-[#5D0B33] text-white{% else %}bg-[#F5F6F6] text-[#6A736E] hover:bg-[#E6E8E7]{% endif %}">
            Sleeves ({{ component_counts.sleeves }})
        </a>
        <a href="?type=pockets{% if search_query %}&search={{ search_query }}{% endif %}{% if order_item_id %}&order_item={{ order_item_id }}{% endif %}"
            class="px-4 py-2 rounded-lg font-medium transition-colors {% if component_type == 'pockets' %}bg-[#5D0B33] text-white{% else %}bg-[#F5F6F6] text-[#6A736E] hover:bg-[#E6E8E7]{% endif %}">
            Pockets ({{ component_counts.pockets }})
        </a>
        <a href="?type=buttons{% if search_query %}&search={{ search_query }}{% endif %}{% if order_item_id %}&order_item={{ order_item_id }}{% endif %}"
            class="px-4 py-2 rounded-lg font-medium transition-colors {% if component_type == 'buttons' %}bg-[#5D0B33] text-white{% else %}bg-[#F5F6F6] text-[#6A736E] hover:bg-[#E6E8E7]{% endif %}">
            Buttons ({{ component_counts.buttons }})
        </a>

        <a href="?type=body{% if search_query %}&search={{ search_query }}{% endif %}{% if order_item_id %}&order_item={{ order_item_id }}{% endif %}"
            class="px-4 py-2 rounded-lg font-medium transition-colors {% if component_type == 'body' %}bg-[#5D0B33] text-white{% else %}bg-[#F5F6F6] text-[#6A736E] hover:bg-[#E6E8E7]{% endif %}">
            Body ({{ component_counts.body }})
        </a>
        <a href="?type=main_categories{% if search_query %}&search={{ search_query }}{% endif %}{% if order_item_id %}&order_item={{ order_item_id }}{% endif %}"
            class="px-4 py-2 rounded-lg font-medium transition-colors {% if component_type == 'main_categories' %}bg-[#5D0B33] text-white{% else %}bg-[#F5F6F6] text-[#6A736E] hover:bg-[#E6E8E7]{% endif %}">
            Main Categories ({{ component_counts.main_categories }})
        </a>
    </div>

    <!-- Search -->
    <form method="GET" class="flex gap-3">
        <input type="hidden" name="type" value="{{ component_type }}">
        {% if order_item_id %}<input type="hidden" name="order_item" value="{{ order_item_id }}">{% endif %}
        <input type="text" name="search" value="{{ search_query }}" placeholder="Search..."
            class="flex-1 px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210] text-[#0D1210] placeholder-[#ADB2B0]">
        <button type="submit"
            class="px-6 py-3 bg-[#0D1210] text-white rounded-xl font-medium hover:bg-[#1a1f1d] transition-colors">
            Search
        </button>
        <a href="?type={{ component_type }}{% if order_item_id %}&order_item={{ order_item_id }}{% endif %}"
            class="px-6 py-3 bg-[#F5F6F6] text-[#0D1210] rounded-xl font-medium hover:bg-[#E6E8E7] transition-colors">
            Clear
        </a>
    </form>
</div>

<!-- Components Table -->
<div class="bg-white border border-[#E6E8E7] rounded-2xl overflow-hidden">
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-[#F5F6F6]">
                <tr>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">ID
                    </th>
                    {% if component_type not in 'fabric_colors,fabric_types' %}
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">Cover
                    </th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">Cover
                        Option</th>
                    {% endif %}
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">Name
                        (EN)</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">Name
                        (AR)</th>

                    {% if component_type == 'fabric_colors' %}
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">Fabric
                        Type</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">Color
                    </th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">Stock
                    </th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">Price
                    </th>
                    {% elif component_type == 'fabric_types' or component_type == 'main_categories' %}
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">Base
                        Price</th>
                    {% if component_type == 'main_categories' %}
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">
                        Reviews</th>
                    {% endif %}
                    {% else %}
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">Fabric
                        Type</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">Fabric
                        Color</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">Price
                    </th>
                    {% endif %}

                    {% if component_type != 'body' %}
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">
                        Priority</th>
                    {% endif %}
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">Status
                    </th>
                    <th class="px-6 py-4 text-left text-xs font-semibold text-[#0D1210] uppercase tracking-wider">
                        Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-[#E6E8E7]">
                {% if items %}
                {% for item in items %}
                <tr class="hover:bg-[#F5F6F6] transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <p class="text-sm font-semibold text-[#0D1210]">{{ item.id }}</p>
                    </td>
                    {% if component_type not in 'fabric_colors,fabric_types' %}
                    <td class="px-6 py-4">
                        {% if item.cover %}
                        <div class="relative group">
                            <a href="{{ item.cover.url }}" target="_blank" class="block">
                                <img src="{{ item.cover.url }}" alt="Cover"
                                    class="w-16 h-16 object-contain rounded-lg border border-[#E6E8E7] hover:shadow-lg transition-shadow bg-white">
                            </a>
                            <div
                                class="absolute inset-0 bg-black bg-opacity-50 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-1">
                                <a href="{{ item.cover.url }}" target="_blank"
                                    class="p-1.5 bg-white text-[#0D1210] rounded hover:bg-[#F5F6F6] transition-colors"
                                    title="View">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    </svg>
                                </a>
                                <button onclick="openImageEditModal({{ item.id }}, 'cover')"
                                    class="p-1.5 bg-white text-[#0B5D35] rounded hover:bg-[#E9F9EF] transition-colors"
                                    title="Edit">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                                    </svg>
                                </button>
                                <button onclick="confirmImageDelete({{ item.id }}, 'cover')"
                                    class="p-1.5 bg-white text-[#BF3636] rounded hover:bg-[#FDECEC] transition-colors"
                                    title="Delete">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        {% else %}
                        <div
                            class="w-16 h-16 bg-[#F5F6F6] rounded-lg border border-[#E6E8E7] flex items-center justify-center">
                            <svg class="w-6 h-6 text-[#ADB2B0]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                        </div>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4">
                        {% if item.cover_option %}
                        <div class="relative group">
                            <a href="{{ item.cover_option.url }}" target="_blank" class="block">
                                <img src="{{ item.cover_option.url }}" alt="Cover Option"
                                    class="w-16 h-16 object-contain rounded-lg border border-[#E6E8E7] hover:shadow-lg transition-shadow bg-white">
                            </a>
                            <div
                                class="absolute inset-0 bg-black bg-opacity-50 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-1">
                                <a href="{{ item.cover_option.url }}" target="_blank"
                                    class="p-1.5 bg-white text-[#0D1210] rounded hover:bg-[#F5F6F6] transition-colors"
                                    title="View">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    </svg>
                                </a>
                                <button onclick="openImageEditModal({{ item.id }}, 'cover_option')"
                                    class="p-1.5 bg-white text-[#0B5D35] rounded hover:bg-[#E9F9EF] transition-colors"
                                    title="Edit">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                                    </svg>
                                </button>
                                <button onclick="confirmImageDelete({{ item.id }}, 'cover_option')"
                                    class="p-1.5 bg-white text-[#BF3636] rounded hover:bg-[#FDECEC] transition-colors"
                                    title="Delete">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        {% else %}
                        <div
                            class="w-16 h-16 bg-[#F5F6F6] rounded-lg border border-[#E6E8E7] flex items-center justify-center">
                            <svg class="w-6 h-6 text-[#ADB2B0]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                        </div>
                        {% endif %}
                    </td>
                    {% endif %}
                    <td class="px-6 py-4">
                        <p class="text-sm font-medium text-[#0D1210]">
                            {% if component_type == 'fabric_colors' %}{{ item.color_name_eng }}
                            {% elif component_type == 'fabric_types' %}{{ item.fabric_name_eng }}
                            {% elif component_type == 'collars' %}{{ item.ghola_type_name_eng }}
                            {% elif component_type == 'sleeves' %}{{ item.sleeves_type_name_eng }}
                            {% elif component_type == 'pockets' %}{{ item.pocket_type_name_eng }}
                            {% elif component_type == 'buttons' %}{{ item.button_type_name_eng }}

                            {% elif component_type == 'body' %}{{ item.body_type_name_eng }}
                            {% elif component_type == 'main_categories' %}{{ item.main_category_name_eng }}
                            {% endif %}
                        </p>
                    </td>
                    <td class="px-6 py-4">
                        <p class="text-sm text-[#6A736E]">
                            {% if component_type == 'fabric_colors' %}{{ item.color_name_arb }}
                            {% elif component_type == 'fabric_types' %}{{ item.fabric_name_arb }}
                            {% elif component_type == 'collars' %}{{ item.ghola_type_name_arb }}
                            {% elif component_type == 'sleeves' %}{{ item.sleeves_type_name_arb }}
                            {% elif component_type == 'pockets' %}{{ item.pocket_type_name_arb }}
                            {% elif component_type == 'buttons' %}{{ item.button_type_name_arb }}

                            {% elif component_type == 'body' %}{{ item.body_type_name_arb }}
                            {% elif component_type == 'main_categories' %}{{ item.main_category_name_arb }}
                            {% endif %}
                        </p>
                    </td>

                    {% if component_type == 'fabric_colors' %}
                    <td class="px-6 py-4">
                        <p class="text-sm text-[#0D1210]">{{ item.fabric_type.fabric_name_eng }}</p>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-2">
                            <div class="w-6 h-6 rounded border border-[#E6E8E7]"
                                style="background-color: {{ item.hex_color }}"></div>
                            <span class="text-xs text-[#6A736E]">{{ item.hex_color }}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <p
                            class="text-sm font-semibold {% if item.quantity > 0 %}text-[#1B9E4B]{% else %}text-[#BF3636]{% endif %}">
                            {{ item.quantity }}
                        </p>
                    </td>
                    <td class="px-6 py-4">
                        <p class="text-sm font-bold text-[#5D0B33]">{{ item.total_price|floatformat:3 }} KD</p>
                    </td>
                    {% elif component_type == 'fabric_types' %}
                    <td class="px-6 py-4">
                        <p class="text-sm font-bold text-[#5D0B33]">{{ item.base_price|floatformat:3 }} KD</p>
                    </td>
                    {% elif component_type == 'main_categories' %}
                    <td class="px-6 py-4">
                        <p class="text-sm font-bold text-[#5D0B33]">{{ item.initial_price|floatformat:3 }} KD</p>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex flex-col gap-1">
                            <div class="flex items-center gap-1">
                                <span class="text-sm font-bold text-[#0D1210]">{{ item.review_rate }}</span>
                                <div class="flex text-amber-400">
                                    {% if item.review_rate >= 1 %}★{% else %}☆{% endif %}
                                    {% if item.review_rate >= 2 %}★{% else %}☆{% endif %}
                                    {% if item.review_rate >= 3 %}★{% else %}☆{% endif %}
                                    {% if item.review_rate >= 4 %}★{% else %}☆{% endif %}
                                    {% if item.review_rate >= 5 %}★{% else %}☆{% endif %}
                                </div>
                            </div>
                            <span class="text-xs text-[#6A736E]">{{ item.review_count }} reviews</span>
                        </div>
                    </td>
                    {% else %}
                    <td class="px-6 py-4">
                        <form method="POST" action="/dashboard/designs/update-fabric-relation/" class="inline-block">
                            {% csrf_token %}
                            <input type="hidden" name="component_type" value="{{ component_type }}">
                            <input type="hidden" name="item_id" value="{{ item.id }}">
                            <input type="hidden" name="field" value="fabric_type">
                            <select name="value" onchange="this.form.submit()"
                                class="text-xs px-2 py-1.5 bg-[#F5F6F6] border border-[#E6E8E7] rounded-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#0D1210]/20 hover:border-[#0D1210]/40 transition-colors">
                                <option value="">-- None --</option>
                                {% for fabric_type in all_fabric_types %}
                                <option value="{{ fabric_type.id }}" {% if item.fabric_type and
                                    item.fabric_type.id==fabric_type.id %}selected{% endif %}>
                                    {{ fabric_type.fabric_name_eng }}
                                </option>
                                {% endfor %}
                            </select>
                        </form>
                    </td>
                    <td class="px-6 py-4">
                        <form method="POST" action="/dashboard/designs/update-fabric-relation/"
                            class="inline-block fabric-color-form" data-item-id="{{ item.id }}">
                            {% csrf_token %}
                            <input type="hidden" name="component_type" value="{{ component_type }}">
                            <input type="hidden" name="item_id" value="{{ item.id }}">
                            <input type="hidden" name="field" value="fabric_color">
                            <select name="value" onchange="this.form.submit()"
                                class="text-xs px-2 py-1.5 bg-[#F5F6F6] border border-[#E6E8E7] rounded-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#0D1210]/20 hover:border-[#0D1210]/40 transition-colors fabric-color-select"
                                data-current-color="{{ item.fabric_color.id|default:'' }}">
                                <option value="">-- None --</option>
                                {% if item.fabric_color %}
                                <option value="{{ item.fabric_color.id }}" selected>{{ item.fabric_color.color_name_eng
                                    }}</option>
                                {% endif %}
                            </select>
                        </form>
                    </td>
                    <td class="px-6 py-4">
                        <p class="text-sm font-bold text-[#5D0B33]">{{ item.initial_price|floatformat:3 }} KD</p>
                    </td>
                    {% endif %}
                    {% if component_type != 'body' %}
                    <td class="px-6 py-4">
                        <p class="text-sm font-medium text-[#0D1210]">{{ item.priority }}</p>
                    </td>
                    {% endif %}
                    <td class="px-6 py-4">
                        {% if component_type == 'fabric_colors' %}
                        <form method="POST" action="/dashboard/designs/update-status/" class="inline-block">
                            {% csrf_token %}
                            <input type="hidden" name="component_type" value="fabric_colors">
                            <input type="hidden" name="item_id" value="{{ item.id }}">
                            <select name="status" onchange="this.form.submit()"
                                class="px-3 py-1 text-xs font-medium rounded-full border-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#5D0B33] {% if item.inStock %}bg-[#E9F9EF] text-[#1B9E4B]{% else %}bg-[#FDECEC] text-[#BF3636]{% endif %}">
                                <option value="in_stock" {% if item.inStock %}selected{% endif %}>In Stock</option>
                                <option value="out_of_stock" {% if not item.inStock %}selected{% endif %}>Out of Stock
                                </option>
                            </select>
                        </form>
                        {% elif component_type == 'fabric_types' %}
                        <form method="POST" action="/dashboard/designs/update-status/" class="inline-block">
                            {% csrf_token %}
                            <input type="hidden" name="component_type" value="fabric_types">
                            <input type="hidden" name="item_id" value="{{ item.id }}">
                            <select name="status" onchange="this.form.submit()"
                                class="px-3 py-1 text-xs font-medium rounded-full border-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#5D0B33] {% if item.isHidden %}bg-[#FDECEC] text-[#BF3636]{% else %}bg-[#E9F9EF] text-[#1B9E4B]{% endif %}">
                                <option value="active" {% if not item.isHidden %}selected{% endif %}>Active</option>
                                <option value="hidden" {% if item.isHidden %}selected{% endif %}>Hidden</option>
                            </select>
                        </form>
                        {% elif component_type == 'buttons' %}
                        <form method="POST" action="/dashboard/designs/update-status/" class="inline-block">
                            {% csrf_token %}
                            <input type="hidden" name="component_type" value="buttons">
                            <input type="hidden" name="item_id" value="{{ item.id }}">
                            <select name="status" onchange="this.form.submit()"
                                class="px-3 py-1 text-xs font-medium rounded-full border-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#5D0B33] {% if item.inStock %}bg-[#E9F9EF] text-[#1B9E4B]{% else %}bg-[#FDECEC] text-[#BF3636]{% endif %}">
                                <option value="in_stock" {% if item.inStock %}selected{% endif %}>In Stock</option>
                                <option value="out_of_stock" {% if not item.inStock %}selected{% endif %}>Out of Stock
                                </option>
                            </select>
                            {% elif component_type == 'main_categories' %}
                            <form method="POST" action="/dashboard/designs/update-status/" class="inline-block">
                                {% csrf_token %}
                                <input type="hidden" name="component_type" value="main_categories">
                                <input type="hidden" name="item_id" value="{{ item.id }}">
                                <select name="status" onchange="this.form.submit()"
                                    class="px-3 py-1 text-xs font-medium rounded-full border-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-[#5D0B33] {% if item.isHidden %}bg-[#FDECEC] text-[#BF3636]{% else %}bg-[#E9F9EF] text-[#1B9E4B]{% endif %}">
                                    <option value="active" {% if not item.isHidden %}selected{% endif %}>Active</option>
                                    <option value="hidden" {% if item.isHidden %}selected{% endif %}>Hidden</option>
                                </select>
                            </form>
                            {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center gap-2">
                            <button onclick="openEditModal({{ item.id }})"
                                class="text-[#0B5D35] hover:text-[#0D1210] font-medium text-sm">
                                Edit
                            </button>
                            <span class="text-[#E6E8E7]">|</span>
                            <button onclick="confirmDelete({{ item.id }})"
                                class="text-[#BF3636] hover:text-[#8B2828] font-medium text-sm">
                                Delete
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="{% if component_type == 'fabric_colors' %}10{% elif component_type == 'fabric_types' %}7{% elif component_type == 'main_categories' %}10{% else %}11{% endif %}"
                        class="px-6 py-12 text-center">
                        <p class="text-[#6A736E]">No {{ component_label|lower }} found</p>
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <h2 id="modalTitle" class="text-2xl font-bold text-[#0D1210]">Edit Item</h2>
            <button onclick="closeEditModal()" class="text-[#6A736E] hover:text-[#0D1210]">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <form id="editForm" method="POST" enctype="multipart/form-data" action="/dashboard/designs/update/">
            {% csrf_token %}
            <input type="hidden" name="component_type" value="{{ component_type }}">
            <input type="hidden" name="item_id" id="edit_item_id">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Name (English)</label>
                    <input type="text" name="name_eng" id="edit_name_eng" required
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
                <div>
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Name (Arabic)</label>
                    <input type="text" name="name_arb" id="edit_name_arb" required
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
            </div>

            <!-- Price field -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div id="price_field">
                    <label class="block text-sm font-medium text-[#0D1210] mb-2" id="price_label">Price (KD)</label>
                    <input type="number" step="0.001" name="price" id="edit_price"
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
                {% if component_type != 'body' %}
                <div>
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Priority</label>
                    <input type="number" step="1" name="priority" id="edit_priority" value="0" required
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
                {% endif %}
            </div>

            <!-- Fabric Type and Color fields for design components -->
            <div id="design_fabric_fields" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Fabric Type (Optional)</label>
                    <select name="fabric_type_id" id="edit_fabric_type_id"
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                        <option value="">-- None --</option>
                        {% for fabric_type in all_fabric_types %}
                        <option value="{{ fabric_type.id }}">{{ fabric_type.fabric_name_eng }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Fabric Color (Optional)</label>
                    <select name="fabric_color_id" id="edit_fabric_color_id"
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                        <option value="">-- None --</option>
                    </select>
                </div>
            </div>

            <!-- Fabric Color specific fields -->
            <div id="fabric_color_fields" class="hidden">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Hex Color</label>
                    <input type="color" name="hex_color" id="edit_hex_color" class="w-full h-12 rounded-xl">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Quantity</label>
                    <input type="number" name="quantity" id="edit_quantity"
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" name="inStock" id="edit_inStock"
                            class="rounded border-gray-300 text-[#5D0B33] focus:ring-[#5D0B33]">
                        <span class="ml-2 text-sm text-[#0D1210]">In Stock</span>
                    </label>
                </div>
            </div>

            <!-- Fabric Type specific fields -->
            <div id="fabric_type_fields" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Originality (English)</label>
                        <input type="text" name="originality" id="edit_originality" placeholder="e.g., Kuwait, Italy"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Originality (Arabic)</label>
                        <input type="text" name="originality_arb" id="edit_originality_arb"
                            placeholder="مثال: الكويت، إيطاليا"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Season *</label>
                        <select name="season" id="edit_season" required
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                            {% for value, label in season_choices %}
                            <option value="{{ value }}">{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Category Type *</label>
                        <select name="category_type" id="edit_category_type" required
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                            {% for value, label in category_type_choices %}
                            <option value="{{ value }}">{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Weight (English)</label>
                        <input type="text" name="weight" id="edit_weight" placeholder="e.g., per sq / m"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Weight (Arabic)</label>
                        <input type="text" name="weight_arb" id="edit_weight_arb" placeholder="مثال: لكل متر مربع"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Composition (English)</label>
                        <input type="text" name="composition" id="edit_composition" placeholder="e.g., 100% Polyester"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Composition (Arabic)</label>
                        <input type="text" name="composition_arb" id="edit_composition_arb"
                            placeholder="مثال: 100% بوليستر"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Softness Grade (1=Soft to 5=Solid)
                        *</label>
                    <input type="number" name="softness_grade" id="edit_softness_grade" min="1" max="5" value="3"
                        required
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Features (English)</label>
                        <textarea name="features" id="edit_features" rows="3"
                            placeholder='["Anti-Static", "Anti-Breakable", "Easy Iron"]'
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]"></textarea>
                        <p class="text-xs text-[#6A736E] mt-1">JSON array format</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Features (Arabic)</label>
                        <textarea name="features_arb" id="edit_features_arb" rows="3"
                            placeholder='["مضاد للكهرباء الساكنة", "مضاد للكسر", "سهل الكي"]'
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]"></textarea>
                        <p class="text-xs text-[#6A736E] mt-1">JSON array format</p>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" name="isHidden" id="edit_isHidden"
                            class="rounded border-gray-300 text-[#5D0B33] focus:ring-[#5D0B33]">
                        <span class="ml-2 text-sm text-[#0D1210]">Hidden</span>
                    </label>
                </div>
            </div>

            <!-- Button specific fields -->
            <div id="button_fields" class="hidden">
                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" name="inStock_button" id="edit_inStock_button"
                            class="rounded border-gray-300 text-[#5D0B33] focus:ring-[#5D0B33]">
                        <span class="ml-2 text-sm text-[#0D1210]">In Stock</span>
                    </label>
                </div>
            </div>

            <!-- Main Category specific fields -->
            <div id="main_category_fields" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Delivery Duration</label>
                        <input type="text" name="duration_delivery_period" id="edit_duration_delivery_period"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Review Rate (1-5)</label>
                        <input type="number" name="review_rate" id="edit_review_rate" min="1" max="5"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Review Count</label>
                        <input type="number" name="review_count" id="edit_review_count"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" name="isHidden" id="edit_isHidden_cat"
                            class="rounded border-gray-300 text-[#5D0B33] focus:ring-[#5D0B33]">
                        <span class="ml-2 text-sm text-[#0D1210]">Hidden</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" name="is_comming_soon" id="edit_is_comming_soon"
                            class="rounded border-gray-300 text-[#5D0B33] focus:ring-[#5D0B33]">
                        <span class="ml-2 text-sm text-[#0D1210]">Coming Soon</span>
                    </label>
                </div>
            </div>

            <!-- Image uploads -->
            <div id="image_fields" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 hidden">
                <div id="cover_field">
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Cover Image (Optional)</label>
                    <div class="mb-2" id="current_cover_preview"></div>
                    <input type="file" name="cover" id="edit_cover" accept="image/*"
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
                <div id="cover_option_field" class="hidden">
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Cover Option Image (Optional)</label>
                    <div class="mb-2" id="current_cover_option_preview"></div>
                    <input type="file" name="cover_option" id="edit_cover_option" accept="image/*"
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
            </div>

            <div class="flex gap-3 mt-6">
                <button type="submit"
                    class="flex-1 px-6 py-3 bg-[#5D0B33] text-white rounded-xl font-medium hover:bg-[#4a0829] transition-colors">
                    Save Changes
                </button>
                <button type="button" onclick="closeEditModal()"
                    class="px-6 py-3 bg-[#F5F6F6] text-[#0D1210] rounded-xl font-medium hover:bg-[#E6E8E7] transition-colors">
                    Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Add Modal -->
<div id="addModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-[#0D1210]">Add New {{ component_label|slice:":-1" }}</h2>
            <button onclick="closeAddModal()" class="text-[#6A736E] hover:text-[#0D1210]">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <form id="addForm" method="POST" enctype="multipart/form-data" action="/dashboard/designs/create/">
            {% csrf_token %}
            <input type="hidden" name="component_type" value="{{ component_type }}">

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Name (English) *</label>
                    <input type="text" name="name_eng" id="add_name_eng" required
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
                <div>
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Name (Arabic) *</label>
                    <input type="text" name="name_arb" id="add_name_arb" required
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
            </div>

            <!-- Price field -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div id="add_price_field">
                    <label class="block text-sm font-medium text-[#0D1210] mb-2" id="add_price_label">Price (KD)
                        *</label>
                    <input type="number" step="0.001" name="price" id="add_price" required
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
                {% if component_type != 'body' %}
                <div>
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Priority</label>
                    <input type="number" step="1" name="priority" id="add_priority" value="0" required
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
                {% endif %}
            </div>

            <!-- Fabric Type and Color fields for design components -->
            <div id="add_design_fabric_fields" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Fabric Type (Optional)</label>
                    <select name="fabric_type_id" id="add_fabric_type_id"
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                        <option value="">-- None --</option>
                        {% for fabric_type in all_fabric_types %}
                        <option value="{{ fabric_type.id }}">{{ fabric_type.fabric_name_eng }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Fabric Color (Optional)</label>
                    <select name="fabric_color_id" id="add_fabric_color_id"
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                        <option value="">-- None --</option>
                    </select>
                </div>
            </div>

            <!-- Fabric Color specific fields -->
            <div id="add_fabric_color_fields" class="hidden">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Fabric Type *</label>
                    <select name="fabric_type" id="add_fabric_type"
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                        <option value="">Select Fabric Type</option>
                        {% for fabric_type in all_fabric_types %}
                        <option value="{{ fabric_type.id }}">{{ fabric_type.fabric_name_eng }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Hex Color *</label>
                    <input type="color" name="hex_color" id="add_hex_color" value="#FFFFFF"
                        class="w-full h-12 rounded-xl">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Quantity *</label>
                    <input type="number" name="quantity" id="add_quantity" value="0"
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" name="inStock" id="add_inStock" checked
                            class="rounded border-gray-300 text-[#5D0B33] focus:ring-[#5D0B33]">
                        <span class="ml-2 text-sm text-[#0D1210]">In Stock</span>
                    </label>
                </div>
            </div>

            <!-- Fabric Type specific fields -->
            <div id="add_fabric_type_fields" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Originality (English)</label>
                        <input type="text" name="originality" id="add_originality" placeholder="e.g., Kuwait, Italy"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Originality (Arabic)</label>
                        <input type="text" name="originality_arb" id="add_originality_arb"
                            placeholder="مثال: الكويت، إيطاليا"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Season *</label>
                        <select name="season" id="add_season" required
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                            {% for value, label in season_choices %}
                            <option value="{{ value }}">{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Category Type *</label>
                        <select name="category_type" id="add_category_type" required
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                            {% for value, label in category_type_choices %}
                            <option value="{{ value }}">{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Weight (English)</label>
                        <input type="text" name="weight" id="add_weight" placeholder="e.g., per sq / m"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Weight (Arabic)</label>
                        <input type="text" name="weight_arb" id="add_weight_arb" placeholder="مثال: لكل متر مربع"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Composition (English)</label>
                        <input type="text" name="composition" id="add_composition" placeholder="e.g., 100% Polyester"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Composition (Arabic)</label>
                        <input type="text" name="composition_arb" id="add_composition_arb"
                            placeholder="مثال: 100% بوليستر"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Softness Grade (1=Soft to 5=Solid)
                        *</label>
                    <input type="number" name="softness_grade" id="add_softness_grade" min="1" max="5" value="3"
                        required
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Features (English)</label>
                        <textarea name="features" id="add_features" rows="3"
                            placeholder='["Anti-Static", "Anti-Breakable", "Easy Iron"]'
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]"></textarea>
                        <p class="text-xs text-[#6A736E] mt-1">JSON array format</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Features (Arabic)</label>
                        <textarea name="features_arb" id="add_features_arb" rows="3"
                            placeholder='["مضاد للكهرباء الساكنة", "مضاد للكسر", "سهل الكي"]'
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]"></textarea>
                        <p class="text-xs text-[#6A736E] mt-1">JSON array format</p>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" name="isHidden" id="add_isHidden"
                            class="rounded border-gray-300 text-[#5D0B33] focus:ring-[#5D0B33]">
                        <span class="ml-2 text-sm text-[#0D1210]">Hidden</span>
                    </label>
                </div>
            </div>

            <!-- Button specific fields -->
            <div id="add_button_fields" class="hidden">
                <div class="mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" name="inStock_button" id="add_inStock_button" checked
                            class="rounded border-gray-300 text-[#5D0B33] focus:ring-[#5D0B33]">
                        <span class="ml-2 text-sm text-[#0D1210]">In Stock</span>
                    </label>
                </div>
            </div>

            <!-- Main Category specific fields -->
            <div id="add_main_category_fields" class="hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Delivery Duration</label>
                        <input type="text" name="duration_delivery_period" id="add_duration_delivery_period"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Review Rate (1-5)</label>
                        <input type="number" name="review_rate" id="add_review_rate" min="1" max="5" value="5"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[#0D1210] mb-2">Review Count</label>
                        <input type="number" name="review_count" id="add_review_count" value="0"
                            class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <label class="flex items-center">
                        <input type="checkbox" name="isHidden" id="add_isHidden_cat"
                            class="rounded border-gray-300 text-[#5D0B33] focus:ring-[#5D0B33]">
                        <span class="ml-2 text-sm text-[#0D1210]">Hidden</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" name="is_comming_soon" id="add_is_comming_soon"
                            class="rounded border-gray-300 text-[#5D0B33] focus:ring-[#5D0B33]">
                        <span class="ml-2 text-sm text-[#0D1210]">Coming Soon</span>
                    </label>
                </div>
            </div>

            <!-- Image uploads -->
            <div id="add_image_fields" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 hidden">
                <div id="add_cover_field">
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Cover Image (Optional)</label>
                    <input type="file" name="cover" id="add_cover" accept="image/*"
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
                <div id="add_cover_option_field" class="hidden">
                    <label class="block text-sm font-medium text-[#0D1210] mb-2">Cover Option Image (Optional)</label>
                    <input type="file" name="cover_option" id="add_cover_option" accept="image/*"
                        class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                </div>
            </div>

            <div class="flex gap-3 mt-6">
                <button type="submit"
                    class="flex-1 px-6 py-3 bg-[#5D0B33] text-white rounded-xl font-medium hover:bg-[#4a0829] transition-colors">
                    Create {{ component_label|slice:":-1" }}
                </button>
                <button type="button" onclick="closeAddModal()"
                    class="px-6 py-3 bg-[#F5F6F6] text-[#0D1210] rounded-xl font-medium hover:bg-[#E6E8E7] transition-colors">
                    Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
        <div class="flex items-center justify-center w-16 h-16 bg-[#FDECEC] rounded-full mb-4 mx-auto">
            <svg class="w-8 h-8 text-[#BF3636]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
        </div>
        <h2 class="text-2xl font-bold text-[#0D1210] text-center mb-2">Delete Item?</h2>
        <p class="text-center text-[#6A736E] mb-6">Are you sure you want to delete this item? This action cannot be
            undone.</p>

        <form id="deleteForm" method="POST" action="/dashboard/designs/delete/">
            {% csrf_token %}
            <input type="hidden" name="component_type" value="{{ component_type }}">
            <input type="hidden" name="item_id" id="delete_item_id">

            <div class="flex gap-3">
                <button type="button" onclick="closeDeleteModal()"
                    class="flex-1 px-6 py-3 bg-[#F5F6F6] text-[#0D1210] rounded-xl font-medium hover:bg-[#E6E8E7] transition-colors">
                    Cancel
                </button>
                <button type="submit"
                    class="flex-1 px-6 py-3 bg-[#BF3636] text-white rounded-xl font-medium hover:bg-[#8B2828] transition-colors">
                    Delete
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Image Edit Modal -->
<div id="imageEditModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-[#0D1210]">Update Image</h2>
            <button onclick="closeImageEditModal()" class="text-[#6A736E] hover:text-[#0D1210]">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <form id="imageEditForm" method="POST" action="/dashboard/designs/update-image/" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="component_type" value="{{ component_type }}">
            <input type="hidden" name="item_id" id="image_edit_item_id">
            <input type="hidden" name="image_field" id="image_edit_field">

            <div class="mb-4">
                <label class="block text-sm font-medium text-[#0D1210] mb-2" id="image_edit_label">Select Image</label>
                <input type="file" name="image" id="image_edit_input" accept="image/*" required
                    class="w-full px-4 py-3 bg-[#F5F6F6] border-none rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0D1210]">
                <p class="text-xs text-[#6A736E] mt-2">Supported formats: JPG, PNG, GIF</p>
            </div>

            <div class="flex gap-3 mt-6">
                <button type="submit"
                    class="flex-1 px-6 py-3 bg-[#5D0B33] text-white rounded-xl font-medium hover:bg-[#4a0829] transition-colors">
                    Upload Image
                </button>
                <button type="button" onclick="closeImageEditModal()"
                    class="px-6 py-3 bg-[#F5F6F6] text-[#0D1210] rounded-xl font-medium hover:bg-[#E6E8E7] transition-colors">
                    Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Image Delete Confirmation Modal -->
<div id="imageDeleteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
        <div class="flex items-center justify-center w-16 h-16 bg-[#FDECEC] rounded-full mb-4 mx-auto">
            <svg class="w-8 h-8 text-[#BF3636]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        </div>
        <h2 class="text-2xl font-bold text-[#0D1210] text-center mb-2">Delete Image?</h2>
        <p class="text-center text-[#6A736E] mb-6">Are you sure you want to delete this image? This action cannot be
            undone.</p>

        <form id="imageDeleteForm" method="POST" action="/dashboard/designs/delete-image/">
            {% csrf_token %}
            <input type="hidden" name="component_type" value="{{ component_type }}">
            <input type="hidden" name="item_id" id="image_delete_item_id">
            <input type="hidden" name="image_field" id="image_delete_field">

            <div class="flex gap-3">
                <button type="button" onclick="closeImageDeleteModal()"
                    class="flex-1 px-6 py-3 bg-[#F5F6F6] text-[#0D1210] rounded-xl font-medium hover:bg-[#E6E8E7] transition-colors">
                    Cancel
                </button>
                <button type="submit"
                    class="flex-1 px-6 py-3 bg-[#BF3636] text-white rounded-xl font-medium hover:bg-[#8B2828] transition-colors">
                    Delete
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    const componentType = '{{ component_type }}';

    function openEditModal(id) {
        // Fetch item data
        fetch(`/dashboard/designs/get/${componentType}/${id}/`)
            .then(response => response.json())
            .then(data => {
                // Set item ID
                document.getElementById('edit_item_id').value = id;

                // Set common fields
                document.getElementById('edit_name_eng').value = data.name_eng;
                document.getElementById('edit_name_arb').value = data.name_arb;

                // Show/hide fields based on component type
                document.getElementById('fabric_color_fields').classList.add('hidden');
                document.getElementById('fabric_type_fields').classList.add('hidden');
                document.getElementById('button_fields').classList.add('hidden');
                document.getElementById('image_fields').classList.add('hidden');
                document.getElementById('cover_option_field').classList.add('hidden');
                document.getElementById('design_fabric_fields').classList.add('hidden');

                // Set price field label and value
                const priceLabel = document.getElementById('price_label');
                const priceField = document.getElementById('edit_price');
                document.getElementById('edit_priority').value = data.priority || 0;

                if (componentType === 'fabric_colors') {
                    document.getElementById('fabric_color_fields').classList.remove('hidden');
                    priceLabel.textContent = 'Price Adjustment (KD)';
                    priceField.value = data.price_adjustment || 0;
                    document.getElementById('edit_hex_color').value = data.hex_color || '#FFFFFF';
                    document.getElementById('edit_quantity').value = data.quantity || 0;
                    document.getElementById('edit_inStock').checked = data.inStock || false;
                    // No images for fabric colors
                } else if (componentType === 'fabric_types') {
                    document.getElementById('fabric_type_fields').classList.remove('hidden');
                    priceLabel.textContent = 'Base Price (KD)';
                    priceField.value = data.base_price || 0;
                    document.getElementById('edit_isHidden').checked = data.isHidden || false;
                    // No images for fabric types
                } else if (componentType === 'buttons') {
                    document.getElementById('design_fabric_fields').classList.remove('hidden');
                    document.getElementById('image_fields').classList.remove('hidden');
                    document.getElementById('button_fields').classList.remove('hidden');
                    document.getElementById('cover_option_field').classList.remove('hidden');
                    priceLabel.textContent = 'Price (KD)';
                    priceField.value = data.initial_price || 0;
                    document.getElementById('edit_inStock_button').checked = data.inStock || false;
                    document.getElementById('edit_fabric_type_id').value = data.fabric_type_id || '';

                    // Load fabric colors if fabric type is set
                    if (data.fabric_type_id) {
                        fetchFabricColors(data.fabric_type_id, 'edit_fabric_color_id').then(() => {
                            document.getElementById('edit_fabric_color_id').value = data.fabric_color_id || '';
                        });
                    }
                } else if (componentType === 'main_categories') {
                    document.getElementById('image_fields').classList.remove('hidden');
                    document.getElementById('main_category_fields').classList.remove('hidden');
                    priceLabel.textContent = 'Base Price (KD)';
                    priceField.value = data.initial_price || 0;
                    document.getElementById('edit_duration_delivery_period').value = data.duration_delivery_period || '';
                    document.getElementById('edit_review_rate').value = data.review_rate || 5;
                    document.getElementById('edit_review_count').value = data.review_count || 0;
                    document.getElementById('edit_isHidden_cat').checked = data.isHidden || false;
                    document.getElementById('edit_is_comming_soon').checked = data.is_comming_soon || false;
                } else {
                    document.getElementById('design_fabric_fields').classList.remove('hidden');
                    document.getElementById('image_fields').classList.remove('hidden');
                    document.getElementById('cover_option_field').classList.remove('hidden');
                    priceLabel.textContent = 'Price (KD)';
                    priceField.value = data.initial_price || 0;
                    document.getElementById('edit_fabric_type_id').value = data.fabric_type_id || '';

                    // Load fabric colors if fabric type is set
                    if (data.fabric_type_id) {
                        fetchFabricColors(data.fabric_type_id, 'edit_fabric_color_id').then(() => {
                            document.getElementById('edit_fabric_color_id').value = data.fabric_color_id || '';
                        });
                    }
                }

                // Show current images
                const coverPreview = document.getElementById('current_cover_preview');
                const coverOptionPreview = document.getElementById('current_cover_option_preview');

                coverPreview.innerHTML = data.cover_url ?
                    `<img src="${data.cover_url}" class="w-24 h-24 object-cover rounded-lg border border-[#E6E8E7]">` : '';

                coverOptionPreview.innerHTML = data.cover_option_url ?
                    `<img src="${data.cover_option_url}" class="w-24 h-24 object-cover rounded-lg border border-[#E6E8E7]">` : '';

                // Show modal
                document.getElementById('editModal').classList.remove('hidden');
                document.getElementById('editModal').classList.add('flex');
            })
            .catch(error => {
                console.error('Error fetching item data:', error);
                alert('Error loading item data');
            });
    }

    function closeEditModal() {
        document.getElementById('editModal').classList.add('hidden');
        document.getElementById('editModal').classList.remove('flex');
        document.getElementById('editForm').reset();
    }

    function openAddModal() {
        // Reset form
        document.getElementById('addForm').reset();

        // Show/hide fields based on component type
        document.getElementById('add_fabric_color_fields').classList.add('hidden');
        document.getElementById('add_fabric_type_fields').classList.add('hidden');
        document.getElementById('add_button_fields').classList.add('hidden');
        document.getElementById('add_image_fields').classList.add('hidden');
        document.getElementById('add_cover_option_field').classList.add('hidden');
        document.getElementById('add_design_fabric_fields').classList.add('hidden');

        const priceLabel = document.getElementById('add_price_label');
        const priceField = document.getElementById('add_price');
        const coverField = document.getElementById('add_cover');

        if (componentType === 'fabric_colors') {
            document.getElementById('add_fabric_color_fields').classList.remove('hidden');
            priceLabel.textContent = 'Price Adjustment (KD) *';
            priceField.value = '0';
            coverField.removeAttribute('required');
        } else if (componentType === 'fabric_types') {
            document.getElementById('add_fabric_type_fields').classList.remove('hidden');
            priceLabel.textContent = 'Base Price (KD) *';
            priceField.value = '0';
            coverField.removeAttribute('required');
        } else if (componentType === 'buttons') {
            document.getElementById('add_design_fabric_fields').classList.remove('hidden');
            document.getElementById('add_image_fields').classList.remove('hidden');
            document.getElementById('add_button_fields').classList.remove('hidden');
            document.getElementById('add_cover_option_field').classList.remove('hidden');
            priceLabel.textContent = 'Price (KD) *';
            priceField.value = '0';
            coverField.setAttribute('required', 'required');
        } else if (componentType === 'main_categories') {
            document.getElementById('add_image_fields').classList.remove('hidden');
            document.getElementById('add_main_category_fields').classList.remove('hidden');
            priceLabel.textContent = 'Base Price (KD) *';
            priceField.value = '0';
            coverField.setAttribute('required', 'required');
        } else {
            document.getElementById('add_design_fabric_fields').classList.remove('hidden');
            document.getElementById('add_image_fields').classList.remove('hidden');
            document.getElementById('add_cover_option_field').classList.remove('hidden');
            priceLabel.textContent = 'Price (KD) *';
            priceField.value = '0';
            coverField.setAttribute('required', 'required');
        }

        // Show modal
        document.getElementById('addModal').classList.remove('hidden');
        document.getElementById('addModal').classList.add('flex');
    }

    function closeAddModal() {
        document.getElementById('addModal').classList.add('hidden');
        document.getElementById('addModal').classList.remove('flex');
        document.getElementById('addForm').reset();
    }

    function confirmDelete(id) {
        // Set the item ID in the delete form
        document.getElementById('delete_item_id').value = id;

        // Show modal
        document.getElementById('deleteModal').classList.remove('hidden');
        document.getElementById('deleteModal').classList.add('flex');
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.add('hidden');
        document.getElementById('deleteModal').classList.remove('flex');
    }

    function openImageEditModal(itemId, imageField) {
        // Set the item ID and field
        document.getElementById('image_edit_item_id').value = itemId;
        document.getElementById('image_edit_field').value = imageField;

        // Update label based on field
        const label = imageField === 'cover' ? 'Cover Image' : 'Cover Option Image';
        document.getElementById('image_edit_label').textContent = label;

        // Show modal
        document.getElementById('imageEditModal').classList.remove('hidden');
        document.getElementById('imageEditModal').classList.add('flex');
    }

    function closeImageEditModal() {
        document.getElementById('imageEditModal').classList.add('hidden');
        document.getElementById('imageEditModal').classList.remove('flex');
        document.getElementById('imageEditForm').reset();
    }

    function confirmImageDelete(itemId, imageField) {
        // Set the item ID and field
        document.getElementById('image_delete_item_id').value = itemId;
        document.getElementById('image_delete_field').value = imageField;

        // Show modal
        document.getElementById('imageDeleteModal').classList.remove('hidden');
        document.getElementById('imageDeleteModal').classList.add('flex');
    }

    function closeImageDeleteModal() {
        document.getElementById('imageDeleteModal').classList.add('hidden');
        document.getElementById('imageDeleteModal').classList.remove('flex');
    }

    // Close modals on escape key
    document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
            closeEditModal();
            closeAddModal();
            closeDeleteModal();
            closeImageEditModal();
            closeImageDeleteModal();
        }
    });

    // Function to fetch and populate fabric colors
    function fetchFabricColors(fabricTypeId, targetSelectId) {
        const selectElement = document.getElementById(targetSelectId);

        // Clear existing options except the first one
        selectElement.innerHTML = '<option value="">-- None --</option>';

        if (!fabricTypeId) {
            return Promise.resolve();
        }

        // Fetch fabric colors
        return fetch(`/dashboard/designs/get-fabric-colors/${fabricTypeId}/`)
            .then(response => response.json())
            .then(colors => {
                colors.forEach(color => {
                    const option = document.createElement('option');
                    option.value = color.id;
                    option.textContent = color.color_name_eng;
                    selectElement.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error fetching fabric colors:', error);
            });
    }

    // Add event listener for Edit Modal fabric type dropdown
    const editFabricTypeSelect = document.getElementById('edit_fabric_type_id');
    if (editFabricTypeSelect) {
        editFabricTypeSelect.addEventListener('change', function () {
            fetchFabricColors(this.value, 'edit_fabric_color_id');
        });
    }

    // Add event listener for Add Modal fabric type dropdown
    const addFabricTypeSelect = document.getElementById('add_fabric_type_id');
    if (addFabricTypeSelect) {
        addFabricTypeSelect.addEventListener('change', function () {
            fetchFabricColors(this.value, 'add_fabric_color_id');
        });
    }

    // Handle fabric type changes in the table to populate fabric color dropdowns
    document.addEventListener('DOMContentLoaded', function () {
        // Get all fabric type selects in the table
        const fabricTypeSelects = document.querySelectorAll('select[name="value"][onchange*="submit"]');

        fabricTypeSelects.forEach(select => {
            // Check if this is a fabric_type select
            const fieldInput = select.parentElement.querySelector('input[name="field"]');
            if (fieldInput && fieldInput.value === 'fabric_type') {
                select.addEventListener('change', function (e) {
                    // Prevent immediate form submission
                    e.preventDefault();

                    const fabricTypeId = this.value;
                    const itemId = this.parentElement.querySelector('input[name="item_id"]').value;

                    // Find the corresponding fabric color select in the same row
                    const row = this.closest('tr');
                    const fabricColorForm = row.querySelector('.fabric-color-form[data-item-id="' + itemId + '"]');

                    if (fabricColorForm) {
                        const fabricColorSelect = fabricColorForm.querySelector('.fabric-color-select');

                        // Clear and populate fabric color dropdown
                        fabricColorSelect.innerHTML = '<option value="">-- None --</option>';

                        if (fabricTypeId) {
                            // Fetch fabric colors for the selected fabric type
                            fetch(`/dashboard/designs/get-fabric-colors/${fabricTypeId}/`)
                                .then(response => response.json())
                                .then(colors => {
                                    colors.forEach(color => {
                                        const option = document.createElement('option');
                                        option.value = color.id;
                                        option.textContent = color.color_name_eng;
                                        fabricColorSelect.appendChild(option);
                                    });

                                    // Now submit the fabric type form
                                    this.form.submit();
                                })
                                .catch(error => {
                                    console.error('Error fetching fabric colors:', error);
                                    // Submit anyway even if fetching colors fails
                                    this.form.submit();
                                });
                        } else {
                            // No fabric type selected, just submit
                            this.form.submit();
                        }
                    } else {
                        // No fabric color form found, just submit
                        this.form.submit();
                    }
                });
            }
        });

        // Load initial fabric colors for existing fabric types in the table
        const fabricColorForms = document.querySelectorAll('.fabric-color-form');
        fabricColorForms.forEach(form => {
            const itemId = form.dataset.itemId;
            const row = form.closest('tr');
            const fabricTypeSelect = row.querySelector('input[name="field"][value="fabric_type"]')?.parentElement.querySelector('select[name="value"]');

            if (fabricTypeSelect && fabricTypeSelect.value) {
                const fabricTypeId = fabricTypeSelect.value;
                const fabricColorSelect = form.querySelector('.fabric-color-select');
                const currentColorId = fabricColorSelect.dataset.currentColor;

                // Fetch and populate fabric colors
                fetch(`/dashboard/designs/get-fabric-colors/${fabricTypeId}/`)
                    .then(response => response.json())
                    .then(colors => {
                        // Clear except None option
                        fabricColorSelect.innerHTML = '<option value="">-- None --</option>';

                        colors.forEach(color => {
                            const option = document.createElement('option');
                            option.value = color.id;
                            option.textContent = color.color_name_eng;
                            if (color.id == currentColorId) {
                                option.selected = true;
                            }
                            fabricColorSelect.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error('Error fetching fabric colors:', error);
                    });
            }
        });
    });

    // Search debouncing
    const searchInput = document.querySelector('input[name="search"]');
    const searchForm = searchInput?.closest('form');
    let searchTimeout;

    if (searchInput && searchForm) {
        searchInput.addEventListener('input', function () {
            // Clear the existing timeout
            clearTimeout(searchTimeout);

            // Set a new timeout to submit the form after 500ms of no typing
            searchTimeout = setTimeout(function () {
                searchForm.submit();
            }, 500);
        });
    }
</script>
{% endblock %}