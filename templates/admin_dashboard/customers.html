{% extends 'admin_dashboard/base.html' %}

{% block title %}Customers - Admin{% endblock %}
{% block page_title %}Customer Management{% endblock %}

{% block content %}
<div class="bg-white rounded-xl p-6 card-shadow">
    <h3 class="text-lg font-semibold text-gray-800 mb-6">Top Customers</h3>

    <div id="customers-list" class="space-y-4">
        <div class="text-center py-8 text-gray-500">
            <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
            <p>Loading customers...</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function fetchCustomers() {
        try {
            const response = await fetch('/purchase/analytics/top-customers/?limit=50&period=365');
            const data = await response.json();

            const container = document.getElementById('customers-list');
            container.innerHTML = data.data.map((customer, index) => `
                <div class="flex items-center justify-between p-6 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                    <div class="flex items-center">
                        <div class="w-12 h-12 rounded-full gradient-bg text-white flex items-center justify-center font-bold text-xl mr-4">
                            ${index + 1}
                        </div>
                        <div>
                            <p class="font-semibold text-gray-800 text-lg">${customer.full_name || customer.username}</p>
                            <p class="text-sm text-gray-500">${customer.email}</p>
                            <p class="text-xs text-gray-400 mt-1">${customer.order_count} orders</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-2xl font-bold text-purple-600">${customer.total_spent.toFixed(3)} KWD</p>
                        <p class="text-sm text-gray-500">Avg: ${customer.avg_order_value.toFixed(3)} KWD</p>
                    </div>
                </div>
            `).join('');
        } catch (error) {
            console.error('Error fetching customers:', error);
        }
    }

    fetchCustomers();
</script>
{% endblock %}
